{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Profile</title>

  <link rel="icon" href="{% static 'analyzer/images/logo.avif' %}">
  <script src="https://cdn.tailwindcss.com"></script>

   <!-- Smooth Card Animation -->
  <script>
tailwind.config = {
  theme: {
    extend: {
      keyframes: {
        fadeIn: { '0%': { opacity: 0, transform: 'translateY(10px)' },
                  '100%': { opacity: 1, transform: 'translateY(0)' } }
      },
      animation: { 'fade-in': 'fadeIn 0.5s ease-out' }
    }
  }
}
</script>
</head>

<body class="bg-gradient-to-br from-slate-100 to-slate-200 min-h-screen">

<!-- NAVIGATION -->
<nav class="bg-white shadow-lg border-b sticky top-0 z-50">
  <div class="max-w-6xl mx-auto px-6 py-4 flex justify-between items-center animate-fade-in">

     <a href="{% url 'dashboard' %}" class="text-2xl font-bold text-indigo-600 hover:text-indigo-800 transition">
  Resume Analyzer
</a>

    <!-- Desktop Menu -->
    <div class="hidden md:flex space-x-4 items-center">
      <a href="{% url 'dashboard' %}" class="text-gray-700 hover:text-purple-600 font-medium px-3 py-2">Dashboard</a>
      <a href="{% url 'upload' %}" class="text-gray-700 hover:text-purple-600 font-medium px-3 py-2">Upload</a>
      <a href="{% url 'reports' %}" class="text-gray-700 hover:text-purple-600 font-medium px-3 py-2">Past Reports</a>

      <!-- ✅ Proper Django Logout -->
      <form method="POST" action="{% url 'logout' %}">
        {% csrf_token %}
        <button type="submit" class="text-red-600 font-medium px-3 py-2">
          Logout
        </button>
      </form>
    </div>

    <!-- Mobile Hamburger -->
    <button onclick="toggleMenu()" class="md:hidden text-gray-700 text-2xl">
      ☰
    </button>
  </div>

  <!-- Mobile Menu -->
  <div id="mobileMenu" class="hidden md:hidden bg-white border-t">
    <a href="{% url 'dashboard' %}" class="block px-6 py-3" onclick="toggleMenu()">Dashboard</a>
    <a href="{% url 'upload' %}" class="block px-6 py-3" onclick="toggleMenu()">Upload</a>
    <a href="{% url 'reports' %}" class="block px-6 py-3" onclick="toggleMenu()">Past Reports</a>

    <form method="POST" action="{% url 'logout' %}">
      {% csrf_token %}
      <button type="submit" class="w-full text-left text-red-600 px-6 py-3">
        Logout
      </button>
    </form>
  </div>
</nav>

<!-- ================= PROFILE ================= -->
<main class="max-w-6xl mx-auto p-6">
  <div class="bg-white rounded-2xl shadow-xl p-8 space-y-8">

    <!-- HEADER -->
    <div class="border-b pb-6">
      <h2 class="text-3xl font-bold text-indigo-600">My Profile</h2>
      <p class="text-gray-500 mt-1">
        View your account details and resume analysis history
      </p>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-10">

      <!-- LEFT -->
      <div class="bg-gray-50 p-6 rounded-xl space-y-2">
  <p>
    <span class="text-gray-500 text-sm">Email</span><br>
    <span class="font-semibold">
      {{ request.user.email }}
    </span>
  </p>

  <p>
    <span class="text-gray-500 text-sm">Username</span><br>
    <span class="font-semibold">
      {{ request.user.first_name|default:request.user.username }}
    </span>
  </p>
</div>


        <div class="grid grid-cols-2 gap-4">
          <div class="bg-indigo-50 p-5 rounded-xl text-center">
            <p class="text-gray-500 text-sm">Total Reports</p>
            <h3 id="totalReports" class="text-3xl font-bold text-indigo-600">0</h3>
          </div>

          <div class="bg-green-50 p-5 rounded-xl text-center">
            <p class="text-gray-500 text-sm">Average ATS</p>
            <h3 id="avgATS" class="text-3xl font-bold text-green-600">0%</h3>
          </div>
        </div>
      </div>

      <!-- RIGHT -->
      <div>
        <h3 class="text-xl font-bold mb-4">
          Resume History
        </h3>

        <div id="historyList" class="space-y-3 max-h-[420px] overflow-y-auto pr-2 scrollbar-thin scrollbar-thumb-indigo-400">
          <p class="text-gray-500 text-center">Loading history...</p>
        </div>
      </div>

    </div>
  </div>
</main>

<script>
  function toggleMenu() {
  document.getElementById("mobileMenu").classList.toggle("hidden");
}
async function loadProfileData() {
  try {
    const res = await fetch("{% url 'reports_api' %}");
    const data = await res.json();

    document.getElementById("totalReports").innerText = data.stats.total ?? 0;
    document.getElementById("avgATS").innerText = (data.stats.average ?? 0) + "%";

    const history = document.getElementById("historyList");

    if (!data.reports.length) {
      history.innerHTML = `
        <div class="bg-gray-50 p-6 rounded-xl text-center text-gray-500">
          No resume analysis found yet.
        </div>`;
      return;
    }

    history.innerHTML = data.reports.map(r => `
      <div class="p-4 bg-gray-100 rounded-xl flex justify-between items-center hover:bg-gray-200 transition">
        <div>
          <p class="font-semibold truncate max-w-[220px]">${r.name}</p>
          <p class="text-xs text-gray-500">${r.analyzed_date}</p>
        </div>
        <span class="text-lg font-bold text-indigo-600">${r.score}%</span>
      </div>
    `).join("");

  } catch (err) {
    document.getElementById("historyList").innerHTML =
      `<p class="text-red-500 text-center">Failed to load profile data</p>`;
    console.error(err);
  }
}


loadProfileData();
</script>


</body>
</html>
